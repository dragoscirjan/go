language: go
go_import_path: github.com/templ-project/go
os:
  - linux
  - osx
  - windows
go:
  # - 1.12.x
  # - 1.13.x
  - 1.14.x
  # - master
env:
  - MODE=app
  - MODE=mod
before_install:
  # https://docs.travis-ci.com/user/private-dependencies#api-token
  - echo -e "machine github.com\n  login $CI_USER_TOKEN" > ~/.netrc
  - if [[ "$TRAVIS_OS_NAME" = "windows" ]]; then choco install -y make; fi
  - if [[ "$TRAVIS_OS_NAME" = "windows" ]]; then powershell -Command 'Set-ExecutionPolicy -ExecutionPolicy RemoteSigned'; fi
  - if [[ "$TRAVIS_OS_NAME" = "osx" ]]; then brew install make; fi
before_script:
  - make init MODE=$MODE
  - make configure IN_TRAVIS=1
scripts:
  - bash .scripts/pre-commit.sh --all
  - if [[ "$MODE" = "app" ]]; then make build;
    else make test;
    fi
  - if [[ "$MODE" == "app" ]]; then make run;
    else echo "Mode 'mod' has no run command";
    fi
  - if [[ "$MODE" == "app" ]]; then
    if [[ "$TRAVIS_OS_NAME" = "osx" ]]; then make run-binary BUILD_OS=darwin; else make run-binary BUILD_OS=$TRAVIS_OS_NAME; fi;
    else echo "Mode 'mod' has no run command";
    fi
  - make docs
after_script:
  - if [[ $TRAVIS_GO_VERSION == '1.14.x' ]] && [[ $TRAVIS_OS_NAME == 'linux' ]] && [[ $MODE == 'mod' ]]; then npm run docs;
    sonar-scanner; fi
notifications:
  email:
    recipients:
      - dragos.cirjan@gmail.com
    on_success: never
    on_failure: always
addons:
  sonarcloud:
    organization: templ-project
    token:
      secure: Y7IiP7SCr+4JMSbGTQWu+2Oya2hFuPpcRbQ70xJI6UZxn8opvI5NJ/+Ui7xRJPBguI0i8XKwnFJTz4+iPanpFoBF5XSdGcNrGjhmgZjmbBR0zugPpPrjvG7fP2RyLXFVRoQZp8k7ZCnLc6CHILloMs4JoEAH3mxehdWzzdDQ1TeOS60lhLt95yYGsUBXPYB6WRngD37nvJdzIkCmCrLlc4kGcMcEg9dp6vDhuDTLV8FUlF9EtopmG/BWS38x3iyoqRqzw/h8K83eicDybZLGz8BohKTJMA+a7hrbdDtx5NoPTQ8T7i2xy7oJEda4f6s5opKXtR/Mxt8K2P1vPnlXgOjlT/LKEOC5Ym2TjgThOS5KiK1PLnwRWFWEnXXQclZnTdJNLLwhD13cy2cNgWGZnh7wh7hiGqr/0CZGn38PPeFOsAdl6DUMDV1XZVDbmnDTYwqF8N6gwbBdNJ5K4PHdn2/P71HopWQtVgQSzvA5HU2Qy1IodglRLmzcJMqZ8lDBsF/QISLR+5GEShSbXsKx8UJ7rpylSKqe6qjWMHiI9NaPEAJC0wLXF91XnbLz7WtC6fw0fbjbXM/Dr3EI8gzU1Bixc1rE+nqaY6onjXAEQw6Kb24zkqyAwiHgJKUI3O2SpJUUJrV3ZV2vdAvGGNlEcd8M/M60XLyh9LBXMlP9vzw=
